alias headers : ../../util//kenutil : : : <include>. ;

alias ThreadPool : ThreadPool.cpp ;

boost 103600 ;

# VW
local with-vw = [ option.get "with-vw" ] ;
if $(with-vw) {
  lib vw : : <search>$(with-vw)/lib ;
  lib allreduce : : <search>$(with-vw)/lib ;
  obj CellContextScoreProducer.o : CellContextScoreProducer.cpp headers : <include>$(with-vw)/library <include>$(with-vw)/vowpalwabbit ;
  alias ccsc : CellContextScoreProducer.o vw allreduce : : : <library>boost_program_options <define>HAVE_VW <include>$(with-vw)/vowpalwabbit ;
  echo "Linking with Vowpal Wabbit" ;
} else {
  alias ccsc ;
}

if [ option.get "with-synlm" : no : yes ] = yes
{
  lib m ;
  obj SyntacticLanguageModel.o : SyntacticLanguageModel.cpp headers : <include>$(TOP)/synlm/hhmm/rvtl/include <include>$(TOP)/synlm/hhmm/wsjparse/include ;
  alias synlm : SyntacticLanguageModel.o m : : : <define>HAVE_SYNLM ;
} else {
  alias synlm ;
}

lib moses_internal :
#All cpp files except those listed
[ glob *.cpp DynSAInclude/*.cpp : PhraseDictionary.cpp ThreadPool.cpp SyntacticLanguageModel.cpp ]
synlm ThreadPool headers ;

alias moses : PhraseDictionary.cpp moses_internal CYKPlusParser//CYKPlusParser LM//LM RuleTable//RuleTable Scope3Parser//Scope3Parser headers ../..//z ../../OnDiskPt//OnDiskPt ;

alias headers-to-install : [ glob-tree *.h ] ;
